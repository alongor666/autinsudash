# Repository Guidelines

全程使用中文沟通，提交代码前请先阅读本指南。

> 最近更新：2025-01-20（与开发进度.md保持同步）

## 🎯 核心工作流程

**开发进度同步约定**：
1. **开发前必读**：每次开始工作前，必须先查阅 `开发进度.md` 了解：
   - 当前版本状态和已完成功能
   - 待办任务的优先级排序
   - 已知的风险阻塞项
2. **开发中更新**：功能开发过程中如遇到新问题或状态变化，及时更新 `开发进度.md`
3. **完成后同步**：功能完成后必须：
   - 将对应任务状态从待办改为已完成
   - 更新相关文档（README.md、PLAN.md、CLAUDE.md、PRD.md）
   - 记录完成时间和关键说明

**文档一致性检查**：每次提交前确保所有文档描述与实际代码功能保持一致。

## 项目结构与模块划分
- `src/app`：Next.js App Router 入口、全局布局与路由动作。
- `src/components`：仪表盘 UI 组件，功能模块请放在 `dashboard/` 下分目录维护。
- `src/contexts` 与 `src/hooks`：共享状态与业务 Hook，保持接口简洁并贴近消费方。
- `src/lib`：纯函数工具库（CSV 解析、配色、IndexedDB 等），避免在此夹带 UI 或副作用。
- `src/ai`：Genkit 流程与本地调试脚本，对话体验相关改动从这里入手。
- `docs/`：产品与设计蓝图，UI 或数据改动前务必先同步阅读。
- `public/data`：本地 CSV 与元数据存放目录，只保存脱敏样例，勿提交敏感数据。

## 构建、测试与开发命令
- `npm run dev`：使用 Turbopack 在 `http://localhost:9010` 启动开发服务器。
- `npm run build`：生成生产环境构建，请在发布或部署前执行一次。
- `npm run start`：基于构建产物启动生产服务，验证打包结果。
- `npm run lint`：运行 Next.js/ESLint 规则，所有警告需修复或在 PR 中说明原因。
- `npm run typecheck`：执行 `tsc --noEmit`，确保类型严格通过。
- `npm run genkit:dev` / `npm run genkit:watch`：调试 `src/ai` 内的 Genkit 流程。

## 代码风格与命名规范
- 全仓库使用 TypeScript，React 组件文件统一采用 `.tsx` 并保持 PascalCase 命名（如 `DashboardHeader`）。
- 优先使用函数式组件与 Hook，并在 JSX 中直接组合 Tailwind 工具类。
- 使用两个空格缩进；提交前运行 `npm run lint` 处理格式与可修复问题。
- 内部模块优先使用 `@/` 别名导入，避免深层相对路径。

## 测试指南
- 目前暂无完整自动化测试，新功能建议配套 Vitest/React Testing Library，文件命名为 `*.test.ts(x)`。
- 处理 CSV 或 IndexedDB 时，请通过夹具（例如放在 `src/lib/__mocks__`）模拟数据，保证测试可重复。
- 在缺少端到端测试前，`npm run typecheck` 与 `npm run lint` 视为基础质量闸门，提交前务必通过。

## 提交与合并请求规范
- Git 提交标题保持动词祈使句，推荐使用但不强制 `feat:`、`fix:` 等前缀。
- 提交信息或 PR 描述中引用相关 Issue/需求编号，便于追踪。
- PR 需包含：变更摘要、界面改动的截图/录屏、数据或脚本迁移说明、以及自测步骤。
- 涉及 CSV 或敏感数据时，请脱敏或改为链接可信存储，不直接纳入仓库。

## 文档同步要求
- **核心原则**：每次功能开发或迭代后，请同步更新 `README.md`、`prd.md` 与 `开发进度.md`，确保文案与代码保持一致。
- **开发进度.md 维护**：必须注明未完成的功能、已删除或弃用的功能、以及预计上线时间或阻塞项。
- **状态标记**：在 `开发进度.md` 中保持 ✅ / 🚧 / ⏸ 状态标记的准确性。
- **新增内容**：若新增目录或配置文件，请在上述文档中补充说明，并在 PR 中提醒评审关注。
- **强制检查**：PR 评审时必须验证 `开发进度.md` 是否与实际代码状态一致。

## 图表显示规范

### 颜色规范
基于满期边际贡献率的颜色映射规则：
- **绿色系**：满期边际贡献率 > 12%，数值越大颜色越深
- **蓝色系**：满期边际贡献率 8%-12% 区间，数值越大颜色越深
- **黄色系**：满期边际贡献率 4%-8% 区间，数值越小颜色越深
- **红色系**：满期边际贡献率 < 4% 区间，数值越小颜色越深

### 排序规范
- 所有图表必须支持排序功能
- 提供从大到小和从小到大的排序切换
- 默认排序方式根据业务需求确定

### 数值显示规范
- **绝对值**：取整数显示（如保费金额、件数）
- **率值或占比**：保留一位小数（如赔付率、费用率）
- **自主系数**：保留三位小数
